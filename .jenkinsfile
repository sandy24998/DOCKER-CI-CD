pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                checkout scm // Jenkins automatically checks out the source code
            }
        }
        stage('Build and Test') {
            steps {
                sh 'python3 -m unittest discover -s tests'
            }
        }
        stage('Docker Build') {
            steps {
                sh 'docker build -t flask-app:latest .' 
            }
        }
        stage('Deploy') {
            steps {
                sh 'docker stop flask-app || true && docker rm flask-app || true'
                sh 'docker run -d --name flask-app -p 5000:5000 flask-app:latest'
            }
        }
    }
}
